openapi: 3.0.3
info:
  title: Hanzi Similarity API
  description: |
    ä¸€ä¸ªåŸºäºè§†è§‰ç›¸ä¼¼åº¦çš„æ±‰å­—æ£€ç´¢APIæœåŠ¡
    
    ## åŠŸèƒ½ç‰¹æ€§
    - ğŸ” æŒ‰å­—ç¬¦æœç´¢ç›¸ä¼¼æ±‰å­—
    - ğŸ”¢ æŒ‰Unicodeç¼–ç æœç´¢
    - ğŸ“¦ æ‰¹é‡æŸ¥è¯¢æ”¯æŒ
    - ğŸ¨ SVGå­—å½¢æ¸²æŸ“
    - ğŸ“Š ç›¸ä¼¼åº¦ç™¾åˆ†æ¯”è®¡ç®—
    
    ## æŠ€æœ¯æ¶æ„
    - **å›¾åƒåµŒå…¥**: ViT (Vision Transformer) æ¨¡å‹
    - **å‘é‡æ•°æ®åº“**: ChromaDB
    - **å­—ä½“æ¸²æŸ“**: æœ¬åœ°å­—ä½“æ–‡ä»¶
    - **Webæ¡†æ¶**: FastAPI
    
    ## æ•°æ®æ¥æº
    æœ¬APIåŒ…å«çº¦27,989ä¸ªCJKå­—ç¬¦çš„é¢„è®¡ç®—å‘é‡ï¼Œè¦†ç›–å¸¸ç”¨æ±‰å­—ã€ç¹ä½“å­—ã€æ—¥æ–‡å‡åç­‰ã€‚
    
  version: 0.3.0
  contact:
    name: GitHub Repository
    url: https://github.com/lihongjie0209/hanzi-similar
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8000
    description: æœ¬åœ°å¼€å‘æœåŠ¡å™¨
  - url: https://your-domain.com
    description: ç”Ÿäº§ç¯å¢ƒ

paths:
  /:
    get:
      summary: é‡å®šå‘åˆ°Web UI
      description: è‡ªåŠ¨é‡å®šå‘åˆ°ç”¨æˆ·ç•Œé¢
      responses:
        '302':
          description: é‡å®šå‘åˆ° /ui
          
  /healthz:
    get:
      summary: å¥åº·æ£€æŸ¥
      description: æ£€æŸ¥APIæœåŠ¡çŠ¶æ€å’Œå‘é‡æ•°æ®åº“è¿æ¥
      responses:
        '200':
          description: æœåŠ¡æ­£å¸¸
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  total_images:
                    type: integer
                    example: 27989
        '503':
          description: æœåŠ¡ä¸å¯ç”¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /search/char:
    post:
      summary: æŒ‰å­—ç¬¦æœç´¢ç›¸ä¼¼æ±‰å­—
      description: |
        è¾“å…¥ä¸€ä¸ªæ±‰å­—å­—ç¬¦ï¼Œè¿”å›è§†è§‰ä¸Šæœ€ç›¸ä¼¼çš„å­—ç¬¦åˆ—è¡¨ã€‚
        
        **ç¤ºä¾‹ç”¨æ³•**:
        - æœç´¢"ä¸­"å­—çš„ç›¸ä¼¼å­—ç¬¦
        - æŸ¥æ‰¾ç¹ç®€ä½“å¯¹åº”å…³ç³»
        - å‘ç°å½¢è¿‘å­—
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryChar'
            examples:
              basic:
                summary: åŸºæœ¬æŸ¥è¯¢
                value:
                  char: "ä¸­"
                  top_k: 5
              advanced:
                summary: æ›´å¤šç»“æœ
                value:
                  char: "é¾"
                  top_k: 20
      responses:
        '200':
          description: æœç´¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
              examples:
                success:
                  summary: æˆåŠŸå“åº”ç¤ºä¾‹
                  value:
                    query: "ä¸­"
                    results:
                      - char: "ä¸­"
                        unicode: "4E2D"
                        distance: 0.0
                        similarity: 100.0
                      - char: "å¿ "
                        unicode: "5FE0"
                        distance: 0.2
                        similarity: 80.0
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /search/unicode:
    post:
      summary: æŒ‰Unicodeç¼–ç æœç´¢ç›¸ä¼¼æ±‰å­—
      description: |
        è¾“å…¥Unicodeç¼–ç ï¼ˆå¦‚"4E2D"æˆ–"U+4E2D"ï¼‰ï¼Œè¿”å›ç›¸ä¼¼å­—ç¬¦ã€‚
        
        **æ”¯æŒæ ¼å¼**:
        - "4E2D" (åå…­è¿›åˆ¶)
        - "U+4E2D" (æ ‡å‡†Unicodeæ ¼å¼)
        - "u+4e2d" (å°å†™)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryUnicode'
            examples:
              hex_format:
                summary: åå…­è¿›åˆ¶æ ¼å¼
                value:
                  unicode: "4E2D"
                  top_k: 5
              unicode_format:
                summary: Unicodeæ ¼å¼
                value:
                  unicode: "U+9F8D"
                  top_k: 10
      responses:
        '200':
          description: æœç´¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
        '400':
          description: Unicodeæ ¼å¼é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: æ‰¾ä¸åˆ°å¯¹åº”çš„å­—ç¬¦
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /search/batch/char:
    post:
      summary: æ‰¹é‡å­—ç¬¦æœç´¢
      description: |
        ä¸€æ¬¡æ€§æœç´¢å¤šä¸ªå­—ç¬¦çš„ç›¸ä¼¼æ±‰å­—ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚
        
        **é€‚ç”¨åœºæ™¯**:
        - æ‰¹é‡å¤„ç†æ–‡æœ¬ä¸­çš„æ±‰å­—
        - å­—å…¸åº”ç”¨çš„æ‰¹é‡æŸ¥è¯¢
        - æ•°æ®åˆ†æå’Œç ”ç©¶
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BatchQueryChar'
            examples:
              multiple_chars:
                summary: å¤šå­—ç¬¦æŸ¥è¯¢
                value:
                  chars: ["ä¸­", "å›½", "äºº"]
                  top_k: 3
      responses:
        '200':
          description: æ‰¹é‡æœç´¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchSearchResponse'
              examples:
                batch_success:
                  summary: æ‰¹é‡æœç´¢ç»“æœ
                  value:
                    queries: ["ä¸­", "å›½"]
                    results:
                      - - char: "ä¸­"
                          unicode: "4E2D"
                          distance: 0.0
                          similarity: 100.0
                        - char: "å¿ "
                          unicode: "5FE0"
                          distance: 0.2
                          similarity: 80.0
                      - - char: "å›½"
                          unicode: "56FD"
                          distance: 0.0
                          similarity: 100.0
                        - char: "åœ‹"
                          unicode: "570B"
                          distance: 0.15
                          similarity: 85.0

  /search/batch/unicode:
    post:
      summary: æ‰¹é‡Unicodeæœç´¢
      description: |
        æ‰¹é‡å¤„ç†Unicodeç¼–ç åˆ—è¡¨ï¼Œè¿”å›æ¯ä¸ªç¼–ç å¯¹åº”çš„ç›¸ä¼¼å­—ç¬¦ã€‚
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BatchQueryUnicode'
            examples:
              unicode_list:
                summary: Unicodeåˆ—è¡¨æŸ¥è¯¢
                value:
                  unicodes: ["4E2D", "U+56FD", "u+4eba"]
                  top_k: 5
      responses:
        '200':
          description: æ‰¹é‡æœç´¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchSearchResponse'

  /glyph/svg/{uhex}:
    get:
      summary: ç”Ÿæˆå­—ç¬¦SVGå›¾åƒ
      description: |
        æ ¹æ®Unicodeç¼–ç ç”Ÿæˆæ¸…æ™°çš„SVGå­—å½¢å›¾åƒã€‚
        
        **ç‰¹ç‚¹**:
        - çŸ¢é‡æ ¼å¼ï¼Œæ— é”¯é½¿
        - ä½¿ç”¨æœ¬åœ°é«˜è´¨é‡å­—ä½“
        - æ”¯æŒCJKæ‰©å±•å­—ç¬¦é›†
        - å®æ—¶æ¸²æŸ“
      parameters:
        - name: uhex
          in: path
          required: true
          description: Unicodeåå…­è¿›åˆ¶ç¼–ç ï¼ˆå¦‚"4E2D"ï¼‰
          schema:
            type: string
            pattern: '^[0-9A-Fa-f]+$'
          examples:
            chinese:
              summary: ä¸­æ–‡å­—ç¬¦
              value: "4E2D"
            traditional:
              summary: ç¹ä½“å­—ç¬¦
              value: "9F8D"
            rare:
              summary: ç”Ÿåƒ»å­—
              value: "2E80"
      responses:
        '200':
          description: SVGå›¾åƒç”ŸæˆæˆåŠŸ
          content:
            image/svg+xml:
              schema:
                type: string
                format: binary
              examples:
                svg_output:
                  summary: SVGè¾“å‡ºç¤ºä¾‹
                  value: |
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                      <text x="50" y="50" font-family="..." font-size="80" text-anchor="middle">ä¸­</text>
                    </svg>
        '400':
          description: Unicodeæ ¼å¼é”™è¯¯
        '404':
          description: å­—ç¬¦ä¸å­˜åœ¨æˆ–æ— æ³•æ¸²æŸ“
        '503':
          description: SVGæ¸²æŸ“æœåŠ¡ä¸å¯ç”¨

components:
  schemas:
    QueryChar:
      type: object
      required:
        - char
      properties:
        char:
          type: string
          description: è¦æœç´¢çš„æ±‰å­—å­—ç¬¦
          maxLength: 1
          example: "ä¸­"
        top_k:
          type: integer
          description: è¿”å›ç»“æœæ•°é‡ï¼ˆé»˜è®¤10ï¼‰
          minimum: 1
          maximum: 100
          default: 10
          example: 5

    QueryUnicode:
      type: object
      required:
        - unicode
      properties:
        unicode:
          type: string
          description: Unicodeç¼–ç ï¼ˆæ”¯æŒ"4E2D"æˆ–"U+4E2D"æ ¼å¼ï¼‰
          pattern: '^([Uu]\+)?[0-9A-Fa-f]+$'
          example: "4E2D"
        top_k:
          type: integer
          description: è¿”å›ç»“æœæ•°é‡ï¼ˆé»˜è®¤10ï¼‰
          minimum: 1
          maximum: 100
          default: 10
          example: 5

    BatchQueryChar:
      type: object
      required:
        - chars
      properties:
        chars:
          type: array
          description: è¦æœç´¢çš„å­—ç¬¦åˆ—è¡¨
          items:
            type: string
            maxLength: 1
          minItems: 1
          maxItems: 50
          example: ["ä¸­", "å›½", "äºº"]
        top_k:
          type: integer
          description: æ¯ä¸ªå­—ç¬¦è¿”å›çš„ç»“æœæ•°é‡
          minimum: 1
          maximum: 100
          default: 10
          example: 3

    BatchQueryUnicode:
      type: object
      required:
        - unicodes
      properties:
        unicodes:
          type: array
          description: Unicodeç¼–ç åˆ—è¡¨
          items:
            type: string
            pattern: '^([Uu]\+)?[0-9A-Fa-f]+$'
          minItems: 1
          maxItems: 50
          example: ["4E2D", "U+56FD", "4EBA"]
        top_k:
          type: integer
          description: æ¯ä¸ªç¼–ç è¿”å›çš„ç»“æœæ•°é‡
          minimum: 1
          maximum: 100
          default: 10
          example: 5

    ResultItem:
      type: object
      properties:
        char:
          type: string
          description: ç›¸ä¼¼çš„æ±‰å­—å­—ç¬¦
          example: "ä¸­"
        unicode:
          type: string
          description: Unicodeåå…­è¿›åˆ¶ç¼–ç 
          example: "4E2D"
        distance:
          type: number
          format: float
          description: å‘é‡è·ç¦»ï¼ˆ0-2ä¹‹é—´ï¼Œè¶Šå°è¶Šç›¸ä¼¼ï¼‰
          minimum: 0
          maximum: 2
          example: 0.15
        similarity:
          type: number
          format: float
          description: ç›¸ä¼¼åº¦ç™¾åˆ†æ¯”ï¼ˆ0-100ï¼‰
          minimum: 0
          maximum: 100
          example: 85.0

    SearchResponse:
      type: object
      properties:
        query:
          type: string
          description: æŸ¥è¯¢çš„å­—ç¬¦æˆ–Unicode
          example: "ä¸­"
        results:
          type: array
          description: ç›¸ä¼¼å­—ç¬¦åˆ—è¡¨ï¼ˆæŒ‰ç›¸ä¼¼åº¦æ’åºï¼‰
          items:
            $ref: '#/components/schemas/ResultItem'

    BatchSearchResponse:
      type: object
      properties:
        queries:
          type: array
          description: æŸ¥è¯¢çš„å­—ç¬¦åˆ—è¡¨
          items:
            type: string
          example: ["ä¸­", "å›½"]
        results:
          type: array
          description: æ¯ä¸ªæŸ¥è¯¢å¯¹åº”çš„ç»“æœåˆ—è¡¨
          items:
            type: array
            items:
              $ref: '#/components/schemas/ResultItem'

    Error:
      type: object
      properties:
        detail:
          type: string
          description: é”™è¯¯è¯¦ç»†ä¿¡æ¯
          example: "Vector database is empty"

tags:
  - name: Search
    description: æ±‰å­—ç›¸ä¼¼åº¦æœç´¢ç›¸å…³æ¥å£
  - name: Batch
    description: æ‰¹é‡æŸ¥è¯¢æ¥å£
  - name: Rendering
    description: å­—å½¢æ¸²æŸ“æœåŠ¡
  - name: Health
    description: ç³»ç»Ÿå¥åº·æ£€æŸ¥
